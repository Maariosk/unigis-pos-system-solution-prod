/* ============== Design tokens (LIGHT THEME) ============== */
:root{
  --bg: #f7f8fa;
  --surface: #ffffff;
  --surface-2: #f3f4f6;
  --line: #e5e7eb;
  --text: #1f2937;
  --muted: #6b7280;

  --brand: #dc2626;      /* rojo primario */
  --brand-ink: #ffffff;
  --brand-50: #fef2f2;
  --brand-100: #fee2e2;

  --chip-bg: #fafafa;
  --chip-line: #e5e7eb;

  --sidebar-w: 260px;
  --sidebar-w-sm: 76px;
  --radius: 12px;
  --shadow: 0 12px 30px rgba(17,24,39,.08);
}

/* ============== Base ============== */
*{ box-sizing:border-box }
html, body, #root{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
}
a{ color:inherit; text-decoration:none }

.page-title{ font-size: 28px; font-weight: 800; margin: 0 0 6px }
.subtitle{ color: var(--muted); margin: 0 0 12px }

/* ============== Layout ============== */
.app{ min-height:100vh; background:var(--bg); color:var(--text); }

/* Sidebar */
.sidebar{
  position:fixed; inset:0 auto 0 0;
  width:var(--sidebar-w);
  background:var(--surface);
  border-right:1px solid var(--line);
  display:flex; flex-direction:column; z-index:30;
}
.sidebar-collapsed{ width:var(--sidebar-w-sm); }

.side-header{
  height:56px; padding:0 12px; display:flex; align-items:center; justify-content:center;
  border-bottom:1px solid var(--line); background:var(--surface); position:sticky; top:0; z-index:2;
}
.side-toggle{
  width:100%; height:40px; display:flex; align-items:center; justify-content:center; gap:12px;
  border-radius:var(--radius); background:var(--surface-2); border:1px solid var(--line); color:var(--text);
}
.side-toggle:hover{ background:#eaecef; }

.side-scroll{ flex:1 1 auto; overflow-y:auto; padding:10px 12px 12px; }
.side-nav{ display:flex; flex-direction:column; gap:6px; }

.side-item, .side-link{
  display:flex; align-items:center; gap:12px; padding:10px 12px; min-height:44px; width:100%;
  border-radius:var(--radius); color:var(--text); background:transparent; border:1px solid transparent;
}
.side-item:hover, .side-link:hover{ background:#f3f4f6; }
.side-link.active{ background: var(--brand-50); border-color: var(--brand-100); }
.side-ico{ width:22px; display:inline-flex; justify-content:center; color:#9ca3af; }
.label{ line-height:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.side-sep{ height:1px; background:var(--line); margin:.75rem 0; }

.sidebar-footer{ padding:10px 12px 14px; border-top:1px solid var(--line); }
.btn-logout{
  display:flex; align-items:center; gap:12px; padding:.6rem .75rem; width:100%;
  border-radius:var(--radius); background:#fff; border:1px solid var(--line); color:#b91c1c;
}
.btn-logout .side-ico{ color:#ef4444; }
.btn-logout:hover{ background:#fff1f1; border-color:#fecaca; }

.sidebar-collapsed .side-item,
.sidebar-collapsed .side-link{ justify-content:center; }
.sidebar-collapsed .label{ display:none; }

/* Main */
.main{ margin-left:var(--sidebar-w); min-height:100vh; padding-bottom:24px; }
.main-collapsed{ margin-left:var(--sidebar-w-sm); }

/* Topbar */
.topbar{
  position:sticky; top:0; z-index:40;
  height:56px; display:flex; align-items:center; gap:12px;
  padding:0 16px; background:var(--surface); border-bottom:1px solid var(--line);
  box-shadow: 0 2px 10px rgba(0,0,0,.04);
}
.tb-toggle{
  width:36px; height:36px; border-radius:10px; border:1px solid var(--line);
  background:var(--surface-2); color:var(--text);
}
.tb-toggle:hover{ background:#eaecef; }

.brand{ display:flex; align-items:center; gap:10px; color:var(--text); }
.brand .logo{
  background: linear-gradient(135deg, var(--brand), #ef4444);
  color: var(--brand-ink);
  padding:2px 7px; border-radius:8px; font-weight:800;
}
.brand .brand-name{ font-weight:700; letter-spacing:.2px; }

.breadcrumbs{ display:flex; align-items:center; gap:6px; margin-left:10px; color:#6b7280; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.crumb-sep{ margin:0 6px; opacity:.45; }

.tb-status{ margin-left:auto; display:flex; align-items:center; gap:10px; }
.tb-chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:var(--chip-bg); border:1px solid var(--chip-line); box-shadow: var(--shadow); }
.tb-ico{ color:var(--brand); }
.tb-text{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.container{ padding:16px; }

@media (max-width:1024px){
  .main{ margin-left:var(--sidebar-w-sm); }
  .sidebar:not(.sidebar-collapsed){ width:220px; }
}

/* Cards */
.card{
  background: var(--surface);
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:18px;
  box-shadow: var(--shadow);
}
.card.elevated{
  box-shadow: 0 14px 34px rgba(17,24,39,.12), 0 2px 6px rgba(17,24,39,.06);
  border: 1px solid rgba(229,231,235,.9);
}

/* Grids */
.grid{ display:grid; gap:16px }
@media (min-width:900px){ .grid-2{ grid-template-columns: 1fr 1fr } }
@media (min-width:900px){ .grid-3{ grid-template-columns: 1fr 1fr 1fr } }

/* Forms */
.form{ display:grid; gap:12px }
.form .row{ display:grid; gap:12px }
@media (min-width:720px){ .form .row.cols-2{ grid-template-columns:1fr 1fr } }

/* etiquetas más legibles */
.label, .form-label{ display:block; font-size:13px; color:#374151; margin:0 0 6px }

/* campos */
.input, .select, .form-control, .form-select{
  width:100%; padding:12px; border-radius:10px;
  border:1px solid #d1d5db; background:#fff; color:var(--text);
  transition: border-color .15s ease, box-shadow .15s ease;
}
.input::placeholder, .form-control::placeholder{ color:#9ca3af }
.input:focus, .select:focus, .form-control:focus, .form-select:focus{
  border-color: var(--brand);
  box-shadow: 0 0 0 3px rgba(220,38,38,.15);
}

/* Estados de validación visibles */
.is-invalid{ border-color:#ef4444 !important; }
.is-invalid:focus{ box-shadow:0 0 0 3px rgba(239,68,68,.18) !important; }
.invalid-feedback{ color:#b91c1c; }

/* Buttons */
.btn{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 14px; border-radius:10px; cursor:pointer;
  border:1px solid #d1d5db; background:#fff; color:var(--text);
  transition: transform .15s ease, background .15s ease, border-color .15s ease;
}
.btn:hover{ background:#f9fafb; border-color:#cbd5e1 }
.btn:active{ transform: translateY(0); }
.btn-primary{
  background:var(--brand); color:var(--brand-ink); border-color:transparent; font-weight:600;
  box-shadow: 0 6px 16px rgba(220,38,38,.18);
}
.btn-primary:hover{ filter:brightness(1.03) }
.btn-danger{ background:#ef4444; color:#fff; border-color:transparent; font-weight:600; }
.btn-ghost{ background:transparent; border-color:transparent; color:var(--text) }
.btn-ghost:hover{ background:#f3f4f6; }

/* Tables */
.table-wrap{ overflow:auto; border-radius:10px; border:1px solid var(--line); background:#fff }
.table{ width:100%; border-collapse:separate; border-spacing:0 }
.table thead th{ position:sticky; top:0; z-index:1; background:#fff; color:#374151; font-weight:700; border-bottom:1px solid var(--line); padding:12px; text-align:left; }
.table tbody td{ padding:12px; border-bottom:1px solid var(--line) }

/* NEW: centrado vertical de todas las celdas */
.table th, .table td{ vertical-align: middle; }

/* Utilidades de alineación/acciones en tablas */
.num{ text-align:right; font-variant-numeric: tabular-nums }
.actions{ text-align:right; width:1%; white-space:nowrap; }
.actions-wrap{ display:inline-flex; align-items:center; justify-content:flex-end; gap:8px; }
.cell-ellipsis{ max-width:320px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.table tbody tr:hover{ background:#f9fafb }

/* Leaflet – contenedor */
.leaflet-container{ height:100%; width:100%; border-radius:12px }

/* ====== Popup PRO para el mapa ====== */
.pv-popup .leaflet-popup-content-wrapper{
  background: var(--surface);
  color: var(--text);
  border: 1px solid var(--line);
  border-radius: 14px;
  box-shadow: var(--shadow);
  padding: 0;
}
.pv-popup .leaflet-popup-tip{
  background: var(--surface);
  border: 1px solid var(--line);
  box-shadow: 0 6px 16px rgba(17,24,39,.08);
}
.pv-popup .leaflet-popup-content{
  margin: 0;
  padding: 0;
  min-width: 260px;
  max-width: 340px; /* evita autopan agresivo */
}
.pv-popup .leaflet-popup-close-button{
  color: #64748b;
  top: 8px; right: 8px;
  transition: transform .15s ease, opacity .15s ease;
}
.pv-popup .leaflet-popup-close-button:hover{
  opacity: .9; transform: scale(1.05);
}


.leaflet-popup.pv-popup.animate__animated{
  animation: none !important;
  transform: none !important;
}

/* Tarjeta interna del popup */
.pv-card{ padding: 12px 14px; }
.pv-card .pv-title{
  font-weight: 800;
  font-size: 15px;
  line-height: 1.25;
  margin: 2px 0 10px;
  color: var(--text);
}
.pv-card .pv-meta{ display: grid; gap: 8px; }
.pv-card .pv-row{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.pv-card .pv-label{
  color:#6b7280; font-size:12px; letter-spacing:.2px;
}
.pv-card .pv-value{ font-weight:600; }
.pv-card .pv-value.pv-mono{
  font-variant-numeric: tabular-nums lining-nums;
  font-feature-settings: "tnum","lnum";
}

/* Badges dentro del popup */
.pv-card .pv-id{
  background: #f8fafc !important;
  border: 1px solid #e2e8f0;
  color: #334155;
  font-weight: 600;
  border-radius: 999px;
  padding: 6px 8px;
}
.pv-card .pv-sale{
  background: linear-gradient(135deg, var(--brand), #ef4444);
  color: var(--brand-ink);
  border: none;
  font-weight: 800;
  border-radius: 999px;
  padding: 6px 10px;
  box-shadow: 0 6px 18px rgba(220,38,38,.22);
}

/* Auth */
.auth-shell{ min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px; }
.auth-card{ width:100%; max-width:420px; background:var(--surface); border:1px solid var(--line); border-radius:12px; padding:20px; box-shadow:var(--shadow); }
.auth-title{ font-weight:800; margin:0 0 8px }
.auth-sub{ color:var(--muted); margin-bottom:16px }

/* ===== Bootstrap helpers + MAP MODAL ===== */
.btn-outline-light{ border-color:#d1d5db; color:#374151; }
.btn-outline-light:hover{ background:#f3f4f6; color:#111827; }

/* Backdrop con blur */
.modal-backdrop{ z-index:1050; }
.modal-backdrop.show{
  opacity:1; background-color: rgba(17,24,39,.55);
  backdrop-filter: blur(4px) brightness(.9);
}
.modal{ z-index:1060; }
.modal-content{
  background:var(--surface); color:var(--text); border:1px solid var(--line);
  border-radius:var(--radius); box-shadow:var(--shadow);
}
.modal-header, .modal-footer{ border-color:var(--line); }

/* Map body */
.map-modal-body{ height:65vh; padding:0; position:relative; }
.map-modal-body .leaflet-container{ border-radius:0 0 var(--radius) var(--radius); }

/* Geosearch (CDN) */
.leaflet-control-geosearch form input{
  background:#fff !important; color:var(--text) !important;
  border:1px solid #d1d5db !important; border-radius:10px !important; padding:8px 10px !important; min-width:260px;
}
.leaflet-control-geosearch .results{
  background:#fff !important; color:var(--text) !important; border:1px solid var(--line) !important;
  border-radius:10px !important; box-shadow:var(--shadow);
}
.leaflet-control-geosearch .results > *{ border-bottom:1px solid var(--line) !important; }
.leaflet-control-geosearch .results > *:hover{ background:#f9fafb !important; }

/* Utils */
.text-muted-2{ color: var(--muted); }
.animate__faster{ --animate-duration:.4s; }

/* Icono SVG del marcador tipo mira (Leaflet divIcon) */
.leaflet-crosshair { color: #e53935; }
.leaflet-crosshair svg{ display:block; filter: drop-shadow(0 1px 2px rgba(0,0,0,.35)); }

/* ============== Dashboard & Map (CONSOLIDADO) ============== */
.section-title{ font-size:18px; font-weight:700; margin:0 0 12px }

.card.equal{ display:flex; flex-direction:column; height:380px; }
@media (min-width:1200px){ .card.equal{ height:440px; } }
.card.equal .fill{ flex:1 1 auto; min-height:0; }

.leaflet-wrapper{ height:520px; border-radius:var(--radius); overflow:hidden; }
@media (max-width:1199.98px){ .leaflet-wrapper{ height:420px; } }

.container > .row + .row{ margin-top: 12px; }

/* ==== Marcadores pulsantes (Leaflet divIcon) ==== */
.pulse-marker{
  display: grid;
  place-items: center;
  cursor: pointer;
  pointer-events: auto;
  touch-action: manipulation;
}
.pulse-marker .pulse-dot{
  position:relative; display:block; width:14px; height:14px;
  border-radius:50%; background:var(--dot,#4f46e5);
  box-shadow:0 2px 6px rgba(0,0,0,.25);
}
.pulse-marker .pulse-dot::before{
  content:""; position:absolute; inset:0; border-radius:50%;
  background:var(--dot,#4f46e5); opacity:.45; transform:scale(1);
  animation:pulseRing 1.8s ease-out infinite;
}
@keyframes pulseRing{
  0%{transform:scale(1);opacity:.45}
  70%{transform:scale(2.6);opacity:0}
  100%{transform:scale(1);opacity:0}
}

/* ==== Recharts: tema claro pulido ==== */
.recharts-cartesian-grid line{ stroke: var(--line) !important; }
.recharts-cartesian-axis-tick text{ fill:#475569 !important; font-size:12px; }
.recharts-legend-item-text{ color:var(--muted) !important; font-size:12px; }

.recharts-default-tooltip{
  background: var(--surface) !important;
  border: 1px solid var(--line) !important;
  border-radius: 10px !important;
  box-shadow: var(--shadow) !important;
  color: var(--text) !important;
  padding: 8px 10px !important;
}
.recharts-legend-wrapper{ padding-top:6px; }


.top5-chart .recharts-bar-rectangle path,
.points-zone-chart .recharts-bar-rectangle path{
  transition: filter .18s ease, transform .18s ease;
}
.top5-chart .recharts-bar-rectangle:hover path,
.points-zone-chart .recharts-bar-rectangle:hover path{
  filter: brightness(1.06);
}

.recharts-label-list text{ fill:#374151; font-size:12px; }

.chart-pulse{
  transform-box: fill-box;
  transform-origin: center;
  animation: pulseRing 1.8s ease-out infinite;
  opacity:.7;
}

/* ================== Points (Listado) ================== */
.points-table, .points-wrap {}
.points-table .table,
.points-wrap .table{ table-layout: fixed; }

/* Col widths (coinciden con <colgroup>) */
.points-table col.col-id,     .points-wrap col.col-id{ width:72px; }
.points-table col.col-desc,   .points-wrap col.col-desc{ width:32%; }
.points-table col.col-zone,   .points-wrap col.col-zone{ width:18%; }
.points-table col.col-money,  .points-wrap col.col-money{ width:14%; }
.points-table col.col-lat,    .points-wrap col.col-lat{ width:12%; }
.points-table col.col-lng,    .points-wrap col.col-lng{ width:12%; }
.points-table col.col-actions,.points-wrap col.col-actions{ width:136px; }

/* Alineaciones */
.points-table thead th, .points-table tbody td,
.points-wrap  thead th, .points-wrap  tbody td{ text-align:left; vertical-align:middle; }

.points-table .num, .points-wrap .num{ text-align:right; font-variant-numeric: tabular-nums; }

.points-table th.actions, .points-table td.actions,
.points-wrap  th.actions, .points-wrap  td.actions{ text-align:right; white-space:nowrap; }

.points-table .cell-ellipsis, .points-wrap .cell-ellipsis{
  max-width:100%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

.points-table .actions-wrap, .points-wrap .actions-wrap{
  display:inline-flex; align-items:center; justify-content:flex-end; gap:8px;
}

.points-table td.actions .btn-primary,
.points-wrap  td.actions .btn-primary{
  background: var(--brand); border-color: var(--brand);
  color: var(--brand-ink); font-weight:600;
  box-shadow: 0 6px 16px rgba(220,38,38,.18);
}
.points-table td.actions .btn-primary:hover,
.points-wrap  td.actions .btn-primary:hover{ filter: brightness(1.03); }

.points-table td.actions .btn,
.points-wrap  td.actions .btn{ padding:8px 12px; border-radius:10px; }

.points-table .table tbody tr:hover,
.points-wrap  .table tbody tr:hover{ background:#f9fafb; }

/* Responsivo suave */
@media (max-width:1100px){
  .points-table col.col-desc, .points-wrap col.col-desc{ width:28%; }
  .points-table col.col-zone, .points-wrap col.col-zone{ width:16%; }
  .points-table col.col-lat,  .points-wrap col.col-lat,
  .points-table col.col-lng,  .points-wrap col.col-lng{ width:10%; }
}

/* ==================== LEAFLET – FIXES DE COMPATIBILIDAD ==================== */
.leaflet-container img,
.leaflet-container .leaflet-tile{
  max-width: none !important;
}

.leaflet-wrapper{ isolation: isolate; }
.leaflet-pane.leaflet-popup-pane{ z-index: 650; } /* por encima de markers y sombras */

/* Transiciones más suaves de Leaflet; no afecta el layout */
.leaflet-container .leaflet-pane,
.leaflet-container .leaflet-marker-icon,
.leaflet-container .leaflet-popup{
  will-change: transform;
}


@media (max-width: 480px){
  .pv-popup .leaflet-popup-content{ max-width: 300px; }
}

/* ===================== KPI — LOOK PRO ===================== */
:root{
  --kpi-sky:     linear-gradient(90deg,#06b6d4,#0ea5e9);
  --kpi-emerald: linear-gradient(90deg,#10b981,#34d399);
  --kpi-indigo:  linear-gradient(90deg,#6366f1,#8b5cf6);
  --kpi-amber:   linear-gradient(90deg,#f59e0b,#fbbf24);
  --kpi-violet:  linear-gradient(90deg,#8b5cf6,#a78bfa);
  --kpi-rose:    linear-gradient(90deg,#f43f5e,#fb7185);
}

/* separación vertical menor entre filas de KPI */
.kpi-row{ row-gap:12px; }

/* Tarjeta KPI con barra superior de acento + efecto lift */
.kpi :where(.card){
  position:relative;
  border-radius:16px;
  border:1px solid rgba(226,232,240,.85);
  background: linear-gradient(180deg,#fff 0%, #fafafa 100%);
  box-shadow: 0 14px 34px rgba(2,8,23,.12), 0 2px 6px rgba(2,8,23,.06);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  min-height:132px;
  display:flex; flex-direction:column;
}
.kpi :where(.card)::before{
  content:"";
  position:absolute; left:0; right:0; top:0; height:6px;
  background: var(--kpi-accent, var(--kpi-sky));
  border-top-left-radius:16px; border-top-right-radius:16px;
}
.kpi:hover :where(.card){
  transform: translateY(-2px);
  box-shadow: 0 18px 40px rgba(2,8,23,.16), 0 6px 14px rgba(2,8,23,.08);
  border-color: rgba(203,213,225,.9);
}


.kpi-sky    { --kpi-accent: var(--kpi-sky); }
.kpi-emerald{ --kpi-accent: var(--kpi-emerald); }
.kpi-indigo { --kpi-accent: var(--kpi-indigo); }
.kpi-amber  { --kpi-accent: var(--kpi-amber); }
.kpi-violet { --kpi-accent: var(--kpi-violet); }
.kpi-rose   { --kpi-accent: var(--kpi-rose); }

.chip-glow{
  box-shadow: 0 8px 24px rgba(14,165,233,.18);
  border-color: #dbeafe !important;
}

.card .section-title{ margin-bottom:4px; }

@media (min-width:992px){
  .col-lg-5 > .card, .col-lg-7 > .card,
  .col-lg-6 > .card { height:100%; display:flex; flex-direction:column; }
}
